/*
 * fixform.c
 *
 *  Created on: 2015Äê5ÔÂ28ÈÕ
 *      Author: Cy
 */


#include "../mathematics.h"
#include <stdio.h>
inline void CpxM2M2c(cplx A[2][2],cplx B[2][2])
{
	int i,j;
	cplx C[2][2];
	C[0][0]=A[0][0]*B[0][0]+A[0][1]*B[1][0];
	C[0][1]=A[0][0]*B[0][1]+A[0][1]*B[1][1];
	C[1][0]=A[1][0]*B[0][0]+A[1][1]*B[1][0];
	C[1][1]=A[1][0]*B[0][1]+A[1][1]*B[1][1];
	for(i=0;i<2;i++)
	{
		for(j=0;j<2;j++)
		{
			B[i][j]=C[i][j];
		}
	}
}
void CpxM2M2(cplx A[2][2],cplx B[2][2],cplx C[2][2])
{
	C[0][0]=A[0][0]*B[0][0]+A[0][1]*B[1][0];
	C[0][1]=A[0][0]*B[0][1]+A[0][1]*B[1][1];
	C[1][0]=A[1][0]*B[0][0]+A[1][1]*B[1][0];
	C[1][1]=A[1][0]*B[0][1]+A[1][1]*B[1][1];
}
int CpxM2inv(cplx A[2][2],cplx B[2][2])
{
	register cplx mod;
	mod=-A[0][1]*A[1][0]+A[0][0]*A[1][1];

	B[0][0]=A[1][1]/mod;
	B[0][1]=-A[0][1]/mod;
	B[1][0]=-A[1][0]/mod;
	B[1][1]=A[0][0]/mod;
	if(mod==0)return 0;
	return 1;

}
void CpxM2toI(cplx a[2][2])
{
	a[0][1]=a[1][0]=0.;
	a[0][0]=a[1][1]=1.;

}
void CpxM2P2c(cplx a[2][2],cplx b[2])
{
	cplx c[2];
	c[0]=a[0][0]*b[0]+a[0][1]*b[1];
	c[1]=a[1][0]*b[0]+a[1][1]*b[1];;
	b[0]=c[0];
	b[1]=c[1];
}
void CpxP2pP2c(cplx a[2],cplx b[2])
{
	b[0]=b[0]+a[0];
	b[1]=b[1]+a[1];
}
inline void CpxM2to0(cplx a[2][2])
{
	int i,j;
	for(i=0;i<2;i++)
	{
		for(j=0;j<2;j++)
		{
			a[i][j]=0;
		}
	}
}

void CpxM2mM2(cplx a[2][2],cplx b[2][2],cplx c[2][2])
{
	int i,j;
	for(i=0;i<2;i++)
	{
		for(j=0;j<2;j++)
		{
			c[i][j]=a[i][j]-b[i][j];
		}
	}
}
inline void CpxM2pM2(cplx a[2][2],cplx b[2][2],cplx c[2][2])
{
	int i,j;
	for(i=0;i<2;i++)
	{
		for(j=0;j<2;j++)
		{
			c[i][j]=a[i][j]+b[i][j];
		}
	}
}
inline void CpxM2pM2c(cplx a[2][2],cplx b[2][2])
{
	int i,j;
	for(i=0;i<2;i++)
	{
		for(j=0;j<2;j++)
		{
			b[i][j]=a[i][j]+b[i][j];
		}
	}
}
inline void CpxM2Sc(double x,cplx a[2][2])
{
	int i,j;
	for(i=0;i<2;i++)
	{
		for(j=0;j<2;j++)
		{
			a[i][j]=x*a[i][j];
		}
	}
}
inline void CpxM2M2M2(cplx a[2][2],cplx b[2][2],cplx c[2][2],cplx d[2][2])
{
	cplx td1[2][2];
	CpxM2M2(b,c,td1);
	CpxM2M2(a,td1,d);
}
void CpCpxMM2(cplx **a,cplx b[2][2])
{
	int i,j;
	for(i=0;i<2;i++)
	{
		for(j=0;j<2;j++)
		{
			b[i][j]=a[i][j];
		}
	}
}
void CpCpxM2M(cplx a[2][2],cplx **b)
{
	int i,j;
	for(i=0;i<2;i++)
	{
		for(j=0;j<2;j++)
		{
			b[i][j]=a[i][j];
		}
	}
}
void CpxM4to0(cplx a[4][4])
{
	unsigned int i,j;
	for(i=0;i<4;i++)
	{
		for(j=0;j<4;j++)
		{
			a[i][j]=0.+0.I;
		}
	}
}
void CpxM8to0(cplx a[8][8])
{
	unsigned int i,j;
	for(i=0;i<8;i++)
	{
		for(j=0;j<8;j++)
		{
			a[i][j]=0.+0.I;
		}
	}
}
void CpxM4M4(cplx A[4][4],cplx B[4][4],cplx C[4][4])
{

	C[0][0]=A[0][0]*B[0][0]+A[0][1]*B[1][0]+A[0][2]*B[2][0]+A[0][3]*B[3][0];
	C[0][1]=A[0][0]*B[0][1]+A[0][1]*B[1][1]+A[0][2]*B[2][1]+A[0][3]*B[3][1];
	C[0][2]=A[0][0]*B[0][2]+A[0][1]*B[1][2]+A[0][2]*B[2][2]+A[0][3]*B[3][2];
	C[0][3]=A[0][0]*B[0][3]+A[0][1]*B[1][3]+A[0][2]*B[2][3]+A[0][3]*B[3][3];
	C[1][0]=A[1][0]*B[0][0]+A[1][1]*B[1][0]+A[1][2]*B[2][0]+A[1][3]*B[3][0];
	C[1][1]=A[1][0]*B[0][1]+A[1][1]*B[1][1]+A[1][2]*B[2][1]+A[1][3]*B[3][1];
	C[1][2]=A[1][0]*B[0][2]+A[1][1]*B[1][2]+A[1][2]*B[2][2]+A[1][3]*B[3][2];
	C[1][3]=A[1][0]*B[0][3]+A[1][1]*B[1][3]+A[1][2]*B[2][3]+A[1][3]*B[3][3];
	C[2][0]=A[2][0]*B[0][0]+A[2][1]*B[1][0]+A[2][2]*B[2][0]+A[2][3]*B[3][0];
	C[2][1]=A[2][0]*B[0][1]+A[2][1]*B[1][1]+A[2][2]*B[2][1]+A[2][3]*B[3][1];
	C[2][2]=A[2][0]*B[0][2]+A[2][1]*B[1][2]+A[2][2]*B[2][2]+A[2][3]*B[3][2];
	C[2][3]=A[2][0]*B[0][3]+A[2][1]*B[1][3]+A[2][2]*B[2][3]+A[2][3]*B[3][3];
	C[3][0]=A[3][0]*B[0][0]+A[3][1]*B[1][0]+A[3][2]*B[2][0]+A[3][3]*B[3][0];
	C[3][1]=A[3][0]*B[0][1]+A[3][1]*B[1][1]+A[3][2]*B[2][1]+A[3][3]*B[3][1];
	C[3][2]=A[3][0]*B[0][2]+A[3][1]*B[1][2]+A[3][2]*B[2][2]+A[3][3]*B[3][2];
	C[3][3]=A[3][0]*B[0][3]+A[3][1]*B[1][3]+A[3][2]*B[2][3]+A[3][3]*B[3][3];

}
void CpxM4M4c(cplx A[4][4],cplx B[4][4])
{
	int i,j;
	cplx C[4][4];
	C[0][0]=A[0][0]*B[0][0]+A[0][1]*B[1][0]+A[0][2]*B[2][0]+A[0][3]*B[3][0];
	C[0][1]=A[0][0]*B[0][1]+A[0][1]*B[1][1]+A[0][2]*B[2][1]+A[0][3]*B[3][1];
	C[0][2]=A[0][0]*B[0][2]+A[0][1]*B[1][2]+A[0][2]*B[2][2]+A[0][3]*B[3][2];
	C[0][3]=A[0][0]*B[0][3]+A[0][1]*B[1][3]+A[0][2]*B[2][3]+A[0][3]*B[3][3];
	C[1][0]=A[1][0]*B[0][0]+A[1][1]*B[1][0]+A[1][2]*B[2][0]+A[1][3]*B[3][0];
	C[1][1]=A[1][0]*B[0][1]+A[1][1]*B[1][1]+A[1][2]*B[2][1]+A[1][3]*B[3][1];
	C[1][2]=A[1][0]*B[0][2]+A[1][1]*B[1][2]+A[1][2]*B[2][2]+A[1][3]*B[3][2];
	C[1][3]=A[1][0]*B[0][3]+A[1][1]*B[1][3]+A[1][2]*B[2][3]+A[1][3]*B[3][3];
	C[2][0]=A[2][0]*B[0][0]+A[2][1]*B[1][0]+A[2][2]*B[2][0]+A[2][3]*B[3][0];
	C[2][1]=A[2][0]*B[0][1]+A[2][1]*B[1][1]+A[2][2]*B[2][1]+A[2][3]*B[3][1];
	C[2][2]=A[2][0]*B[0][2]+A[2][1]*B[1][2]+A[2][2]*B[2][2]+A[2][3]*B[3][2];
	C[2][3]=A[2][0]*B[0][3]+A[2][1]*B[1][3]+A[2][2]*B[2][3]+A[2][3]*B[3][3];
	C[3][0]=A[3][0]*B[0][0]+A[3][1]*B[1][0]+A[3][2]*B[2][0]+A[3][3]*B[3][0];
	C[3][1]=A[3][0]*B[0][1]+A[3][1]*B[1][1]+A[3][2]*B[2][1]+A[3][3]*B[3][1];
	C[3][2]=A[3][0]*B[0][2]+A[3][1]*B[1][2]+A[3][2]*B[2][2]+A[3][3]*B[3][2];
	C[3][3]=A[3][0]*B[0][3]+A[3][1]*B[1][3]+A[3][2]*B[2][3]+A[3][3]*B[3][3];
	for(i=0;i<4;i++)
	{
		for(j=0;j<4;j++)
		{
			B[i][j]=C[i][j];
		}
	}
}
void CpxM8M8(cplx a[8][8],cplx b[8][8],cplx c[8][8])
{
	unsigned int i,j,k;
	register cplx temp;

	for(i=0;i<8;i++)
	{
		for(j=0;j<8;j++)
		{
			temp=0.+0.I;
			for(k=0;k<8;k++)
			{
				temp=temp+a[i][k]*b[k][j];
			}
			c[i][j]=temp;
		}
	}
}

void CpxM4P4(cplx a[4][4],cplx b[4],cplx c[4])
{
	unsigned int i,j;
	register cplx temp;

	for(i=0;i<4;i++)
	{
		temp=0.+0.I;
		for(j=0;j<4;j++)
		{
			temp=temp+a[i][j]*b[j];
		}
		c[i]=temp;
	}
}
void CpxM8P8(cplx a[8][8],cplx b[8],cplx c[8])
{
	unsigned int i,j;
	register cplx temp;

	for(i=0;i<8;i++)
	{
		temp=0.+0.I;
		for(j=0;j<8;j++)
		{
			temp=temp+a[i][j]*b[j];

		}
		c[i]=temp;
	}
}
void CpxM2pt(cplx a[2][2])
{
	int i,j;
	for(i=0;i<2;i++)
	{
		printf("%d:",i);
		for(j=0;j<2;j++)
		{
			printf("(%lf,%lf) ",creal(a[i][j]),cimag(a[i][j]));
		}
		printf("\n");
	}
}
void CpxM4pt(cplx a[4][4])
{
	int i,j;
	for(i=0;i<4;i++)
	{
		printf("%d:",i);
		for(j=0;j<4;j++)
		{
			printf("(%lf,%lf) ",creal(a[i][j]),cimag(a[i][j]));
		}
		printf("\n");
	}
}
void CpxM8pt(cplx a[8][8])
{
	int i,j;
	for(i=0;i<8;i++)
	{
		for(j=0;j<8;j++)
		{
			printf("(%lf,%lf) ",creal(a[i][j]),cimag(a[i][j]));
		}
		printf("\n");
	}
}

inline cplx CpxM4det(cplx A[4][4])
{
	cplx re;
	re=A[0][3]*A[1][2]*A[2][1]*A[3][0]-A[0][2]*A[1][3]*A[2][1]*A[3][0]-A[0][3]*A[1][1]*A[2][2]*A[3][0]+A[0][1]*A[1][3]*A[2][2]*A[3][0]+A[0][2]*A[1][1]*A[2][3]*A[3][0]-\
	A[0][1]*A[1][2]*A[2][3]*A[3][0]-A[0][3]*A[1][2]*A[2][0]*A[3][1]+A[0][2]*A[1][3]*A[2][0]*A[3][1]+A[0][3]*A[1][0]*A[2][2]*A[3][1]-A[0][0]*A[1][3]*A[2][2]*A[3][1]-\
	A[0][2]*A[1][0]*A[2][3]*A[3][1]+A[0][0]*A[1][2]*A[2][3]*A[3][1]+A[0][3]*A[1][1]*A[2][0]*A[3][2]-A[0][1]*A[1][3]*A[2][0]*A[3][2]-A[0][3]*A[1][0]*A[2][1]*A[3][2]+\
	A[0][0]*A[1][3]*A[2][1]*A[3][2]+A[0][1]*A[1][0]*A[2][3]*A[3][2]-A[0][0]*A[1][1]*A[2][3]*A[3][2]-A[0][2]*A[1][1]*A[2][0]*A[3][3]+A[0][1]*A[1][2]*A[2][0]*A[3][3]+\
	A[0][2]*A[1][0]*A[2][1]*A[3][3]-A[0][0]*A[1][2]*A[2][1]*A[3][3]-A[0][1]*A[1][0]*A[2][2]*A[3][3]+A[0][0]*A[1][1]*A[2][2]*A[3][3];
	return re;
}

inline cplx CpxM3dt(cplx A[3][3])
{
	cplx re;
	re=-(A[0][2]*A[1][1]*A[2][0])+A[0][1]*A[1][2]*A[2][0]+A[0][2]*A[1][0]*A[2][1]-A[0][0]*A[1][2]*A[2][1]-A[0][1]*A[1][0]*A[2][2]+A[0][0]*A[1][1]*A[2][2];
	return re;
}

int CpxM4inv(cplx A[4][4],cplx B[4][4])
{

	register cplx det;

	det=CpxM4det(A);

	B[0][0]=(-A[1][3]*A[2][2]*A[3][1]+A[1][2]*A[2][3]*A[3][1]+A[1][3]*A[2][1]*A[3][2]-A[1][1]*A[2][3]*A[3][2]-A[1][2]*A[2][1]*A[3][3]+A[1][1]*A[2][2]*A[3][3])/det;
	B[0][1]=(A[0][3]*A[2][2]*A[3][1]-A[0][2]*A[2][3]*A[3][1]-A[0][3]*A[2][1]*A[3][2]+A[0][1]*A[2][3]*A[3][2]+A[0][2]*A[2][1]*A[3][3]-A[0][1]*A[2][2]*A[3][3])/det;
	B[0][2]=(-A[0][3]*A[1][2]*A[3][1]+A[0][2]*A[1][3]*A[3][1]+A[0][3]*A[1][1]*A[3][2]-A[0][1]*A[1][3]*A[3][2]-A[0][2]*A[1][1]*A[3][3]+A[0][1]*A[1][2]*A[3][3])/det;
	B[0][3]=(A[0][3]*A[1][2]*A[2][1]-A[0][2]*A[1][3]*A[2][1]-A[0][3]*A[1][1]*A[2][2]+A[0][1]*A[1][3]*A[2][2]+A[0][2]*A[1][1]*A[2][3]-A[0][1]*A[1][2]*A[2][3])/det;
	B[1][0]=(A[1][3]*A[2][2]*A[3][0]-A[1][2]*A[2][3]*A[3][0]-A[1][3]*A[2][0]*A[3][2]+A[1][0]*A[2][3]*A[3][2]+A[1][2]*A[2][0]*A[3][3]-A[1][0]*A[2][2]*A[3][3])/det;
	B[1][1]=(-A[0][3]*A[2][2]*A[3][0]+A[0][2]*A[2][3]*A[3][0]+A[0][3]*A[2][0]*A[3][2]-A[0][0]*A[2][3]*A[3][2]-A[0][2]*A[2][0]*A[3][3]+A[0][0]*A[2][2]*A[3][3])/det;
	B[1][2]=(A[0][3]*A[1][2]*A[3][0]-A[0][2]*A[1][3]*A[3][0]-A[0][3]*A[1][0]*A[3][2]+A[0][0]*A[1][3]*A[3][2]+A[0][2]*A[1][0]*A[3][3]-A[0][0]*A[1][2]*A[3][3])/det;
	B[1][3]=(-A[0][3]*A[1][2]*A[2][0]+A[0][2]*A[1][3]*A[2][0]+A[0][3]*A[1][0]*A[2][2]-A[0][0]*A[1][3]*A[2][2]-A[0][2]*A[1][0]*A[2][3]+A[0][0]*A[1][2]*A[2][3])/det;
	B[2][0]=(-A[1][3]*A[2][1]*A[3][0]+A[1][1]*A[2][3]*A[3][0]+A[1][3]*A[2][0]*A[3][1]-A[1][0]*A[2][3]*A[3][1]-A[1][1]*A[2][0]*A[3][3]+A[1][0]*A[2][1]*A[3][3])/det;
	B[2][1]=(A[0][3]*A[2][1]*A[3][0]-A[0][1]*A[2][3]*A[3][0]-A[0][3]*A[2][0]*A[3][1]+A[0][0]*A[2][3]*A[3][1]+A[0][1]*A[2][0]*A[3][3]-A[0][0]*A[2][1]*A[3][3])/det;
	B[2][2]=(-A[0][3]*A[1][1]*A[3][0]+A[0][1]*A[1][3]*A[3][0]+A[0][3]*A[1][0]*A[3][1]-A[0][0]*A[1][3]*A[3][1]-A[0][1]*A[1][0]*A[3][3]+A[0][0]*A[1][1]*A[3][3])/det;
	B[2][3]=(A[0][3]*A[1][1]*A[2][0]-A[0][1]*A[1][3]*A[2][0]-A[0][3]*A[1][0]*A[2][1]+A[0][0]*A[1][3]*A[2][1]+A[0][1]*A[1][0]*A[2][3]-A[0][0]*A[1][1]*A[2][3])/det;
	B[3][0]=(A[1][2]*A[2][1]*A[3][0]-A[1][1]*A[2][2]*A[3][0]-A[1][2]*A[2][0]*A[3][1]+A[1][0]*A[2][2]*A[3][1]+A[1][1]*A[2][0]*A[3][2]-A[1][0]*A[2][1]*A[3][2])/det;
	B[3][1]=(-A[0][2]*A[2][1]*A[3][0]+A[0][1]*A[2][2]*A[3][0]+A[0][2]*A[2][0]*A[3][1]-A[0][0]*A[2][2]*A[3][1]-A[0][1]*A[2][0]*A[3][2]+A[0][0]*A[2][1]*A[3][2])/det;
	B[3][2]=(A[0][2]*A[1][1]*A[3][0]-A[0][1]*A[1][2]*A[3][0]-A[0][2]*A[1][0]*A[3][1]+A[0][0]*A[1][2]*A[3][1]+A[0][1]*A[1][0]*A[3][2]-A[0][0]*A[1][1]*A[3][2])/det;
	B[3][3]=(-A[0][2]*A[1][1]*A[2][0]+A[0][1]*A[1][2]*A[2][0]+A[0][2]*A[1][0]*A[2][1]-A[0][0]*A[1][2]*A[2][1]-A[0][1]*A[1][0]*A[2][2]+A[0][0]*A[1][1]*A[2][2])/det;
	if(det==0)return 0;
	return 1;
}

inline void CpxM4pM4(cplx AA[4][4],cplx BB[4][4],cplx CC[4][4])
{
	CC[0][0]=AA[0][0]+BB[0][0];
	CC[0][1]=AA[0][1]+BB[0][1];
	CC[0][2]=AA[0][2]+BB[0][2];
	CC[0][3]=AA[0][3]+BB[0][3];
	CC[1][0]=AA[1][0]+BB[1][0];
	CC[1][1]=AA[1][1]+BB[1][1];
	CC[1][2]=AA[1][2]+BB[1][2];
	CC[1][3]=AA[1][3]+BB[1][3];
	CC[2][0]=AA[2][0]+BB[2][0];
	CC[2][1]=AA[2][1]+BB[2][1];
	CC[2][2]=AA[2][2]+BB[2][2];
	CC[2][3]=AA[2][3]+BB[2][3];
	CC[3][0]=AA[3][0]+BB[3][0];
	CC[3][1]=AA[3][1]+BB[3][1];
	CC[3][2]=AA[3][2]+BB[3][2];
	CC[3][3]=AA[3][3]+BB[3][3];

}

inline void CpxM4mM4(cplx AA[4][4],cplx BB[4][4])
{
	BB[0][0]=AA[0][0]-BB[0][0];
	BB[0][1]=AA[0][1]-BB[0][1];
	BB[0][2]=AA[0][2]-BB[0][2];
	BB[0][3]=AA[0][3]-BB[0][3];
	BB[1][0]=AA[1][0]-BB[1][0];
	BB[1][1]=AA[1][1]-BB[1][1];
	BB[1][2]=AA[1][2]-BB[1][2];
	BB[1][3]=AA[1][3]-BB[1][3];
	BB[2][0]=AA[2][0]-BB[2][0];
	BB[2][1]=AA[2][1]-BB[2][1];
	BB[2][2]=AA[2][2]-BB[2][2];
	BB[2][3]=AA[2][3]-BB[2][3];
	BB[3][0]=AA[3][0]-BB[3][0];
	BB[3][1]=AA[3][1]-BB[3][1];
	BB[3][2]=AA[3][2]-BB[3][2];
	BB[3][3]=AA[3][3]-BB[3][3];


}

inline void CpCpxM4M(cplx AA[4][4],cplx **BB)
{
	BB[0][0]=AA[0][0];
	BB[0][1]=AA[0][1];
	BB[0][2]=AA[0][2];
	BB[0][3]=AA[0][3];
	BB[1][0]=AA[1][0];
	BB[1][1]=AA[1][1];
	BB[1][2]=AA[1][2];
	BB[1][3]=AA[1][3];
	BB[2][0]=AA[2][0];
	BB[2][1]=AA[2][1];
	BB[2][2]=AA[2][2];
	BB[2][3]=AA[2][3];
	BB[3][0]=AA[3][0];
	BB[3][1]=AA[3][1];
	BB[3][2]=AA[3][2];
	BB[3][3]=AA[3][3];
}

inline void CpxpM4(cplx AA[4][4],cplx BB[4][4])
{
	BB[0][0]=-AA[0][0];
	BB[0][1]=-AA[0][1];
	BB[0][2]=-AA[0][2];
	BB[0][3]=-AA[0][3];
	BB[1][0]=-AA[1][0];
	BB[1][1]=-AA[1][1];
	BB[1][2]=-AA[1][2];
	BB[1][3]=-AA[1][3];
	BB[2][0]=-AA[2][0];
	BB[2][1]=-AA[2][1];
	BB[2][2]=-AA[2][2];
	BB[2][3]=-AA[2][3];
	BB[3][0]=-AA[3][0];
	BB[3][1]=-AA[3][1];
	BB[3][2]=-AA[3][2];
	BB[3][3]=-AA[3][3];
}
inline void CpxcM4(cplx AA[4][4],cplx BB[4][4])
{
	BB[0][0]=AA[0][0];
	BB[0][1]=AA[0][1];
	BB[0][2]=AA[0][2];
	BB[0][3]=AA[0][3];
	BB[1][0]=AA[1][0];
	BB[1][1]=AA[1][1];
	BB[1][2]=AA[1][2];
	BB[1][3]=AA[1][3];
	BB[2][0]=AA[2][0];
	BB[2][1]=AA[2][1];
	BB[2][2]=AA[2][2];
	BB[2][3]=AA[2][3];
	BB[3][0]=AA[3][0];
	BB[3][1]=AA[3][1];
	BB[3][2]=AA[3][2];
	BB[3][3]=AA[3][3];
}
void CpxM8inv(cplx AA[8][8],cplx BB[8][8])
{
	int i,j;
	cplx A[4][4],B[4][4],C[4][4],D[4][4];
	cplx B11[4][4],B12[4][4],B21[4][4],B22[4][4];
	cplx invA[4][4],invB[4][4],invC[4][4],invD[4][4];
	cplx tMtx[4][4],dba[4][4],cdba[4][4],db[4][4],ba[4][4],tMtx1[4][4];
	unsigned int select;

	for(i=0;i<4;i++)
	{
		for(j=0;j<4;j++)
		{
			A[i][j]=AA[i][j];
			B[i][j]=AA[i][j+4];
			C[i][j]=AA[i+4][j];
			D[i][j]=AA[i+4][j+4];
		}
	}
	select=0;
	if(CpxM4det(A)!=0.0+0.0I)select+=1;
	if(CpxM4det(B)!=0.0+0.0I)select+=2;
	if(CpxM4det(C)!=0.0+0.0I)select+=4;
	if(CpxM4det(D)!=0.0+0.0I)select+=8;


	switch(select)
	{
	case 9:
		CpxM4to0(B12);
		CpxM4to0(B21);
		CpxM4inv(A,B11);
		CpxM4inv(D,B22);
		break;
	case 6:
		CpxM4to0(B11);
		CpxM4to0(B22);
		CpxM4inv(C,B12);
		CpxM4inv(B,B21);
		break;


	case 7:
		CpxM4to0(B11);
		CpxM4inv(C,B12);
		CpxM4inv(B,B21);
		CpxM4M4(B21,A,tMtx);
		CpxM4M4(tMtx,B12,tMtx1);
		CpxpM4(tMtx1,B22);
		break;
	case 11:
		CpxM4to0(B21);
		CpxM4inv(A,B11);
		CpxM4inv(D,B22);
		CpxM4M4(B11,B,tMtx);
		CpxM4M4(tMtx,B22,tMtx1);
		CpxpM4(tMtx1,B12);
		break;
	case 13:
		CpxM4to0(B12);
		CpxM4inv(A,B11);
		CpxM4inv(D,B22);
		CpxM4M4(B22,C,tMtx);
		CpxM4M4(tMtx,B11,tMtx1);
		CpxpM4(tMtx1,B21);
		break;
	case 14:
		CpxM4to0(B22);
		CpxM4inv(C,B12);
		CpxM4inv(B,B21);
		CpxM4M4(B12,D,tMtx);
		CpxM4M4(tMtx,B21,tMtx1);
		CpxpM4(tMtx1,B11);
		break;
	case 15:
		CpxM4inv(A,invA);
		CpxM4inv(B,invB);
		CpxM4inv(C,invC);
		CpxM4inv(D,invD);


		CpxM4M4(D,invB,tMtx);
		CpxM4M4(tMtx,A,dba);
		CpxM4mM4(C,dba);
		CpxM4inv(dba,cdba);

		CpxM4M4(D,invB,db);
		CpxM4M4(cdba,db,tMtx1);
		CpxpM4(tMtx1,B11);

		CpxcM4(cdba,B12);

		CpxM4M4(invB,A,ba);
		CpxM4M4(ba,tMtx1,tMtx);
		CpxM4pM4(invB,tMtx,B21);

		CpxM4M4(ba,cdba,tMtx);
		CpxpM4(tMtx,B22);
		break;
	default:
		CpxM4to0(B11);
		CpxM4to0(B12);
		CpxM4to0(B21);
		CpxM4to0(B22);
	}
	for(i=0;i<4;i++)
	{
		for(j=0;j<4;j++)
		{
			BB[i][j]=B11[i][j];
			BB[i][j+4]=B12[i][j];
			BB[i+4][j]=B21[i][j];
			BB[i+4][j+4]=B22[i][j];
		}
	}

}

void CpxMM2c(cplx **A,cplx B[2][2])
{
	int i,j;
	cplx C[2][2];
	C[0][0]=A[0][0]*B[0][0]+A[0][1]*B[1][0];
	C[0][1]=A[0][0]*B[0][1]+A[0][1]*B[1][1];
	C[1][0]=A[1][0]*B[0][0]+A[1][1]*B[1][0];
	C[1][1]=A[1][0]*B[0][1]+A[1][1]*B[1][1];
	for(i=0;i<2;i++)
	{
		for(j=0;j<2;j++)
		{
			B[i][j]=C[i][j];
		}
	}
}
inline void CpCpxMM4(cplx **A,cplx B[4][4])
{
	int i,j;
	for(i=0;i<4;i++)
	{
		for(j=0;j<4;j++)
		{
			B[i][j]=A[i][j];
		}
	}
}
void CpxMquard2(cplx **rs,cplx A[2][2],cplx B[2][2],cplx C[2][2],cplx D[2][2])
{
	int i,j;
	for(i=0;i<2;i++)
	{
		for(j=0;j<2;j++)
		{
			A[i][j]=rs[i][j];
			B[i][j]=rs[i][j+2];
			C[i][j]=rs[i+2][j];
			D[i][j]=rs[i+2][j+2];
		}
	}
}
